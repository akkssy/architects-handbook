<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Gateway System - Comprehensive Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --secondary: #8b5cf6; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card { @apply bg-white rounded-xl shadow-lg p-6 mb-6; }
        .nav-link { @apply px-4 py-2 rounded-lg transition-all duration-200 hover:bg-indigo-100; }
        .nav-link.active { @apply bg-indigo-600 text-white; }
        .section { @apply py-12 px-4; }
        .mermaid { background: #f8fafc; border-radius: 12px; padding: 20px; }
        pre[class*="language-"] { border-radius: 12px; margin: 1rem 0; }
        .tab-btn { @apply px-4 py-2 rounded-t-lg border-b-2 border-transparent; }
        .tab-btn.active { @apply border-indigo-600 text-indigo-600 bg-indigo-50; }
        .timeline-item::before { content: ''; @apply absolute left-0 top-0 w-4 h-4 bg-indigo-600 rounded-full -translate-x-1/2; }
        .cost-card { @apply bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-6 border border-indigo-100; }
        details summary { cursor: pointer; }
        details summary::-webkit-details-marker { display: none; }

        /* Animation Styles */
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes slideRight { 0% { transform: translateX(-20px); opacity: 0; } 100% { transform: translateX(0); opacity: 1; } }
        @keyframes slideDown { 0% { transform: translateY(-10px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        @keyframes dataFlow { 0% { stroke-dashoffset: 100; } 100% { stroke-dashoffset: 0; } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 5px rgba(99, 102, 241, 0.5); } 50% { box-shadow: 0 0 25px rgba(99, 102, 241, 0.9), 0 0 50px rgba(99, 102, 241, 0.5); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes checkmark { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

        .flow-node { transition: all 0.3s ease; }
        .flow-node.active {
            animation: glow 1s ease-in-out infinite;
            transform: scale(1.08);
            z-index: 10;
        }
        .flow-node.completed {
            background: linear-gradient(135deg, #10b981, #059669) !important;
            border-color: #059669 !important;
            color: white !important;
        }
        .flow-node.completed * { color: white !important; }
        .flow-arrow { transition: all 0.3s ease; }
        .flow-arrow.active { color: #6366f1 !important; animation: bounce 0.5s ease-in-out infinite; font-size: 1.5rem; }
        .flow-arrow.completed { color: #10b981 !important; animation: checkmark 0.3s ease-out; }
        .step-detail { animation: fadeInUp 0.5s ease-out; }
        .data-packet { position: absolute; width: 12px; height: 12px; background: #6366f1; border-radius: 50%; }
        .progress-bar { transition: width 0.5s ease; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-sm shadow-sm z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-2">
                    <svg class="w-8 h-8 text-indigo-600" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M4 4h16a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2zm0 4v10h16V8H4zm2 2h4v2H6v-2zm6 0h6v2h-6v-2zm-6 4h4v2H6v-2z"/>
                    </svg>
                    <span class="font-bold text-xl">Payment Gateway Guide</span>
                </div>
                <div class="hidden md:flex space-x-1" id="nav-links">
                    <a href="#animated-flow" class="nav-link">üé¨ Live Demo</a>
                    <a href="#architecture" class="nav-link">Architecture</a>
                    <a href="#tech-stack" class="nav-link">Tech Stack</a>
                    <a href="#compliance" class="nav-link">Compliance</a>
                    <a href="#features" class="nav-link">Features</a>
                    <a href="#gtm" class="nav-link">Go-to-Market</a>
                    <a href="#timeline" class="nav-link">Timeline</a>
                    <a href="#costs" class="nav-link">Costs</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="gradient-bg text-white pt-24 pb-16">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h1 class="text-5xl font-bold mb-4">Production-Ready Payment Gateway</h1>
            <p class="text-xl opacity-90 mb-8">Comprehensive guide to building a Stripe-like payment processing system</p>
            <div class="flex justify-center space-x-4">
                <span class="bg-white/20 px-4 py-2 rounded-full">PCI DSS Compliant</span>
                <span class="bg-white/20 px-4 py-2 rounded-full">Multi-Currency</span>
                <span class="bg-white/20 px-4 py-2 rounded-full">Fraud Detection</span>
                <span class="bg-white/20 px-4 py-2 rounded-full">Real-time Processing</span>
            </div>
        </div>
    </header>

    <!-- Table of Contents -->
    <section class="max-w-7xl mx-auto px-4 -mt-8 relative z-10">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold mb-6">üìã Table of Contents</h2>
            <div class="grid md:grid-cols-3 gap-4">
                <a href="#animated-flow" class="flex items-center p-4 bg-gradient-to-r from-indigo-100 to-purple-100 rounded-lg hover:from-indigo-200 hover:to-purple-200 transition border-2 border-indigo-300">
                    <span class="text-3xl mr-4">üé¨</span>
                    <div><h3 class="font-semibold text-indigo-700">Interactive Demo</h3><p class="text-sm text-indigo-600">Watch payment flow in real-time</p></div>
                </a>
                <a href="#architecture" class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-indigo-50 transition">
                    <span class="text-3xl mr-4">üèóÔ∏è</span>
                    <div><h3 class="font-semibold">1. System Architecture</h3><p class="text-sm text-gray-600">Components, microservices, database design</p></div>
                </a>
                <a href="#tech-stack" class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-indigo-50 transition">
                    <span class="text-3xl mr-4">‚öôÔ∏è</span>
                    <div><h3 class="font-semibold">2. Technical Stack</h3><p class="text-sm text-gray-600">Languages, databases, infrastructure</p></div>
                </a>
                <a href="#compliance" class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-indigo-50 transition">
                    <span class="text-3xl mr-4">üîí</span>
                    <div><h3 class="font-semibold">3. Compliance & Legal</h3><p class="text-sm text-gray-600">PCI DSS, regulations, KYC/AML</p></div>
                </a>
                <a href="#features" class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-indigo-50 transition">
                    <span class="text-3xl mr-4">üí≥</span>
                    <div><h3 class="font-semibold">4. Core Features</h3><p class="text-sm text-gray-600">Payment flow, fraud, webhooks</p></div>
                </a>
                <a href="#gtm" class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-indigo-50 transition">
                    <span class="text-3xl mr-4">üöÄ</span>
                    <div><h3 class="font-semibold">5. Go-to-Market</h3><p class="text-sm text-gray-600">Pricing, onboarding, SDKs</p></div>
                </a>
                <a href="#timeline" class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-indigo-50 transition">
                    <span class="text-3xl mr-4">üìÖ</span>
                    <div><h3 class="font-semibold">6. Timeline & Costs</h3><p class="text-sm text-gray-600">Milestones, team, budget</p></div>
                </a>
            </div>
        </div>
    </section>

    <!-- Animated Payment Flow Section -->
    <section id="animated-flow" class="section bg-gradient-to-br from-slate-900 to-indigo-900 text-white">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-4xl font-bold mb-2">üé¨ Interactive Payment Flow Animation</h2>
            <p class="text-indigo-200 mb-8">Watch how a payment flows through the system in real-time</p>

            <!-- Control Panel -->
            <div class="bg-white/10 backdrop-blur rounded-xl p-6 mb-8">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <button id="startAnimation" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 transition">
                            <span id="playIcon">‚ñ∂Ô∏è</span> Start Payment
                        </button>
                        <button id="resetAnimation" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-3 rounded-lg font-semibold transition">
                            üîÑ Reset
                        </button>
                        <select id="scenarioSelect" class="bg-white/20 text-white px-4 py-3 rounded-lg">
                            <option value="success">‚úÖ Successful Payment</option>
                            <option value="3ds">üîê 3D Secure Required</option>
                            <option value="fraud">üö´ Fraud Detected</option>
                            <option value="declined">‚ùå Card Declined</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-sm">Speed:</span>
                        <input type="range" id="speedControl" min="1" max="5" value="3" class="w-24">
                        <span id="speedLabel" class="text-sm">Normal</span>
                    </div>
                </div>
                <!-- Progress Bar -->
                <div class="mt-4 bg-white/20 rounded-full h-2 overflow-hidden">
                    <div id="progressBar" class="progress-bar bg-gradient-to-r from-green-400 to-emerald-500 h-full w-0"></div>
                </div>
            </div>

            <!-- Main Animation Area -->
            <div class="grid lg:grid-cols-3 gap-6">
                <!-- Flow Diagram -->
                <div class="lg:col-span-2 bg-white/5 backdrop-blur rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-6">Payment Flow</h3>

                    <!-- Animated Flow Nodes -->
                    <div class="relative">
                        <!-- Row 1: Customer Side -->
                        <div class="flex items-center justify-between mb-8">
                            <div id="node-customer" class="flow-node bg-blue-500/20 border-2 border-blue-400 rounded-xl p-4 w-36 text-center">
                                <div class="text-3xl mb-2">üë§</div>
                                <div class="font-semibold text-sm">Customer</div>
                                <div class="text-xs text-blue-300">Enters card</div>
                            </div>
                            <div id="arrow-1" class="flow-arrow text-2xl text-gray-500">‚Üí</div>
                            <div id="node-merchant" class="flow-node bg-purple-500/20 border-2 border-purple-400 rounded-xl p-4 w-36 text-center">
                                <div class="text-3xl mb-2">üè™</div>
                                <div class="font-semibold text-sm">Merchant</div>
                                <div class="text-xs text-purple-300">Checkout page</div>
                            </div>
                            <div id="arrow-2" class="flow-arrow text-2xl text-gray-500">‚Üí</div>
                            <div id="node-gateway" class="flow-node bg-indigo-500/20 border-2 border-indigo-400 rounded-xl p-4 w-36 text-center">
                                <div class="text-3xl mb-2">üåê</div>
                                <div class="font-semibold text-sm">API Gateway</div>
                                <div class="text-xs text-indigo-300">Rate limit, auth</div>
                            </div>
                        </div>

                        <!-- Row 2: Processing -->
                        <div class="flex items-center justify-between mb-8">
                            <div id="node-tokenizer" class="flow-node bg-yellow-500/20 border-2 border-yellow-400 rounded-xl p-4 w-36 text-center">
                                <div class="text-3xl mb-2">üîê</div>
                                <div class="font-semibold text-sm">Tokenization</div>
                                <div class="text-xs text-yellow-300">Secure vault</div>
                            </div>
                            <div id="arrow-3" class="flow-arrow text-2xl text-gray-500">‚Üí</div>
                            <div id="node-fraud" class="flow-node bg-red-500/20 border-2 border-red-400 rounded-xl p-4 w-36 text-center">
                                <div class="text-3xl mb-2">üõ°Ô∏è</div>
                                <div class="font-semibold text-sm">Fraud Engine</div>
                                <div class="text-xs text-red-300">Risk scoring</div>
                            </div>
                            <div id="arrow-4" class="flow-arrow text-2xl text-gray-500">‚Üí</div>
                            <div id="node-3ds" class="flow-node bg-orange-500/20 border-2 border-orange-400 rounded-xl p-4 w-36 text-center">
                                <div class="text-3xl mb-2">üîí</div>
                                <div class="font-semibold text-sm">3D Secure</div>
                                <div class="text-xs text-orange-300">If required</div>
                            </div>
                        </div>

                        <!-- Row 3: External -->
                        <div class="flex items-center justify-between mb-8">
                            <div id="node-processor" class="flow-node bg-cyan-500/20 border-2 border-cyan-400 rounded-xl p-4 w-36 text-center">
                                <div class="text-3xl mb-2">‚ö°</div>
                                <div class="font-semibold text-sm">Processor</div>
                                <div class="text-xs text-cyan-300">Authorization</div>
                            </div>
                            <div id="arrow-5" class="flow-arrow text-2xl text-gray-500">‚Üí</div>
                            <div id="node-network" class="flow-node bg-pink-500/20 border-2 border-pink-400 rounded-xl p-4 w-36 text-center">
                                <div class="text-3xl mb-2">üí≥</div>
                                <div class="font-semibold text-sm">Card Network</div>
                                <div class="text-xs text-pink-300">Visa/MC/Amex</div>
                            </div>
                            <div id="arrow-6" class="flow-arrow text-2xl text-gray-500">‚Üí</div>
                            <div id="node-bank" class="flow-node bg-emerald-500/20 border-2 border-emerald-400 rounded-xl p-4 w-36 text-center">
                                <div class="text-3xl mb-2">üè¶</div>
                                <div class="font-semibold text-sm">Issuing Bank</div>
                                <div class="text-xs text-emerald-300">Approve/Decline</div>
                            </div>
                        </div>

                        <!-- Row 4: Response -->
                        <div class="flex items-center justify-center">
                            <div id="node-result" class="flow-node bg-gray-500/20 border-2 border-gray-400 rounded-xl p-4 w-48 text-center">
                                <div id="resultIcon" class="text-4xl mb-2">‚è≥</div>
                                <div id="resultText" class="font-semibold">Waiting...</div>
                                <div id="resultDetail" class="text-xs text-gray-300">Start the animation</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step Details Panel -->
                <div class="bg-white/5 backdrop-blur rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-4">üìã Current Step</h3>
                    <div id="stepDetails" class="space-y-4">
                        <div class="bg-white/10 rounded-lg p-4">
                            <div class="text-sm text-indigo-300 mb-1">Step 0 of 10</div>
                            <div class="font-semibold text-lg mb-2">Ready to Start</div>
                            <p class="text-sm text-gray-300">Click "Start Payment" to begin the animation and see how a payment flows through the system.</p>
                        </div>
                    </div>

                    <!-- Live Data Panel -->
                    <h3 class="text-xl font-semibold mt-6 mb-4">üìä Live Data</h3>
                    <div id="liveData" class="bg-gray-900/50 rounded-lg p-4 font-mono text-xs overflow-auto max-h-64">
                        <div class="text-gray-500">// Payment data will appear here...</div>
                    </div>

                    <!-- Timing Stats -->
                    <h3 class="text-xl font-semibold mt-6 mb-4">‚è±Ô∏è Timing</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>Tokenization</span>
                            <span id="time-token" class="text-gray-400">--</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Fraud Check</span>
                            <span id="time-fraud" class="text-gray-400">--</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Authorization</span>
                            <span id="time-auth" class="text-gray-400">--</span>
                        </div>
                        <div class="flex justify-between text-sm font-semibold border-t border-white/20 pt-2 mt-2">
                            <span>Total Time</span>
                            <span id="time-total" class="text-green-400">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Event Log -->
            <div class="mt-8 bg-white/5 backdrop-blur rounded-xl p-6">
                <h3 class="text-xl font-semibold mb-4">üìú Event Log</h3>
                <div id="eventLog" class="bg-gray-900/50 rounded-lg p-4 font-mono text-xs h-32 overflow-auto">
                    <div class="text-gray-500">[System] Ready to process payments...</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 1: System Architecture -->
    <section id="architecture" class="section bg-white">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-4xl font-bold mb-2">üèóÔ∏è 1. System Architecture</h2>
            <p class="text-gray-600 mb-8">High-level architecture showing all components of a production payment gateway</p>

            <!-- High-Level Architecture Diagram -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">High-Level Architecture</h3>
                <div class="mermaid">
flowchart TB
    subgraph External["External Clients"]
        MerchantApp["Merchant Applications"]
        MobileSDK["Mobile SDKs"]
        WebSDK["Web SDKs/JS"]
    end

    subgraph Edge["Edge Layer"]
        CDN["CDN / WAF"]
        APIGateway["API Gateway"]
        LB["Load Balancer"]
    end

    subgraph Core["Core Services"]
        PaymentOrchestrator["Payment Orchestrator"]
        AuthService["Auth Service"]
        MerchantService["Merchant Service"]
        TokenService["Tokenization"]
    end

    subgraph Processing["Payment Processing"]
        PaymentProcessor["Payment Processor"]
        FraudEngine["Fraud Engine"]
        RoutingEngine["Smart Router"]
    end

    subgraph Settlement["Settlement"]
        SettlementEngine["Settlement Engine"]
        LedgerService["Ledger Service"]
    end

    subgraph Integrations["External"]
        CardNetworks["Card Networks"]
        Banks["Banks"]
    end

    External --> Edge
    Edge --> Core
    Core --> Processing
    Processing --> Integrations
    Processing --> Settlement
                </div>
            </div>

            <!-- Microservices Breakdown -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Microservices Breakdown</h3>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="bg-indigo-50 rounded-lg p-4">
                        <h4 class="font-bold text-indigo-700 mb-2">üö™ API Gateway</h4>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ Request routing</li>
                            <li>‚Ä¢ Rate limiting</li>
                            <li>‚Ä¢ API key validation</li>
                            <li>‚Ä¢ Request/response logging</li>
                        </ul>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4">
                        <h4 class="font-bold text-purple-700 mb-2">üîê Identity Service</h4>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ Merchant authentication</li>
                            <li>‚Ä¢ API key management</li>
                            <li>‚Ä¢ OAuth 2.0 / JWT</li>
                            <li>‚Ä¢ RBAC permissions</li>
                        </ul>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="font-bold text-blue-700 mb-2">üè™ Merchant Service</h4>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ Merchant onboarding</li>
                            <li>‚Ä¢ KYC/KYB processing</li>
                            <li>‚Ä¢ Configuration management</li>
                            <li>‚Ä¢ Fee structure</li>
                        </ul>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4">
                        <h4 class="font-bold text-green-700 mb-2">üí≥ Payment Orchestrator</h4>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ Payment intent creation</li>
                            <li>‚Ä¢ State machine management</li>
                            <li>‚Ä¢ Idempotency handling</li>
                            <li>‚Ä¢ Multi-step coordination</li>
                        </ul>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4">
                        <h4 class="font-bold text-yellow-700 mb-2">üîí Tokenization Service</h4>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ Card tokenization</li>
                            <li>‚Ä¢ PAN vault</li>
                            <li>‚Ä¢ Token lifecycle</li>
                            <li>‚Ä¢ Network tokenization</li>
                        </ul>
                    </div>
                    <div class="bg-red-50 rounded-lg p-4">
                        <h4 class="font-bold text-red-700 mb-2">üõ°Ô∏è Fraud Engine</h4>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ Rule engine</li>
                            <li>‚Ä¢ ML scoring</li>
                            <li>‚Ä¢ Velocity checks</li>
                            <li>‚Ä¢ Device fingerprinting</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Database Schema -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Database Schema Design</h3>
                <div class="mb-4">
                    <div class="flex space-x-2 border-b">
                        <button class="tab-btn active" onclick="showTab('merchants')">Merchants</button>
                        <button class="tab-btn" onclick="showTab('transactions')">Transactions</button>
                        <button class="tab-btn" onclick="showTab('payment_methods')">Payment Methods</button>
                        <button class="tab-btn" onclick="showTab('settlements')">Settlements</button>
                    </div>
                </div>
                <div id="tab-merchants" class="tab-content">
                    <pre><code class="language-sql">CREATE TABLE merchants (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    external_id VARCHAR(50) UNIQUE NOT NULL,  -- "acct_xxx"
    business_name VARCHAR(255) NOT NULL,
    business_type VARCHAR(50) NOT NULL,
    email VARCHAR(255) NOT NULL,
    country_code CHAR(2) NOT NULL,

    -- Verification & Compliance
    kyc_status VARCHAR(20) DEFAULT 'pending',
    risk_tier VARCHAR(20) DEFAULT 'standard',
    status VARCHAR(20) DEFAULT 'pending',

    -- Configuration
    default_currency CHAR(3) DEFAULT 'USD',
    statement_descriptor VARCHAR(22),
    metadata JSONB DEFAULT '{}',

    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_merchants_external_id ON merchants(external_id);
CREATE INDEX idx_merchants_status ON merchants(status);</code></pre>
                </div>
                <div id="tab-transactions" class="tab-content hidden">
                    <pre><code class="language-sql">CREATE TABLE transactions (
    id UUID NOT NULL DEFAULT gen_random_uuid(),
    external_id VARCHAR(50) NOT NULL,  -- "ch_xxx"
    merchant_id UUID NOT NULL,
    payment_intent_id UUID,

    -- Transaction Type & Amounts
    type VARCHAR(30) NOT NULL,  -- 'charge', 'refund', 'capture'
    amount BIGINT NOT NULL,  -- In cents
    currency CHAR(3) NOT NULL,
    fee_amount BIGINT DEFAULT 0,
    net_amount BIGINT DEFAULT 0,

    -- Status & Processor
    status VARCHAR(30) NOT NULL,
    processor_transaction_id VARCHAR(100),
    processor_auth_code VARCHAR(20),

    -- Risk & Fraud
    risk_score DECIMAL(5,2),
    risk_level VARCHAR(20),

    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    PRIMARY KEY (id, created_at)
) PARTITION BY RANGE (created_at);</code></pre>
                </div>
                <div id="tab-payment_methods" class="tab-content hidden">
                    <pre><code class="language-sql">CREATE TABLE payment_methods (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    external_id VARCHAR(50) UNIQUE NOT NULL,  -- "pm_xxx"
    merchant_id UUID NOT NULL,
    customer_id UUID,

    type VARCHAR(30) NOT NULL,  -- 'card', 'bank_account'

    -- Card Details (tokenized)
    card_token_id UUID,  -- References secure vault
    card_brand VARCHAR(20),
    card_last_four CHAR(4),
    card_exp_month SMALLINT,
    card_exp_year SMALLINT,
    card_fingerprint VARCHAR(64),

    -- 3D Secure
    three_d_secure_supported BOOLEAN DEFAULT FALSE,

    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>
                </div>
                <div id="tab-settlements" class="tab-content hidden">
                    <pre><code class="language-sql">CREATE TABLE settlements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    external_id VARCHAR(50) UNIQUE NOT NULL,  -- "stl_xxx"
    merchant_id UUID NOT NULL,

    period_start TIMESTAMPTZ NOT NULL,
    period_end TIMESTAMPTZ NOT NULL,

    -- Amounts
    gross_amount BIGINT NOT NULL,
    fee_amount BIGINT NOT NULL,
    net_amount BIGINT NOT NULL,
    currency CHAR(3) NOT NULL,

    -- Counts
    transaction_count INT NOT NULL,
    refund_count INT DEFAULT 0,

    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    expected_arrival_date DATE,

    created_at TIMESTAMPTZ DEFAULT NOW()
);</code></pre>
                </div>
            </div>

            <!-- Security Architecture -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Security Architecture (PCI DSS Layers)</h3>
                <div class="mermaid">
flowchart TB
    subgraph Public["Public Zone"]
        WAF["WAF + DDoS Protection"]
    end

    subgraph App["Application Zone"]
        API["API Gateway - TLS 1.3"]
        AppServers["App Servers"]
    end

    subgraph CDE["Cardholder Data Environment"]
        Token["Tokenization Service"]
        Vault["Card Vault - AES-256"]
        HSM["HSM - FIPS 140-2"]
    end

    subgraph Data["Data Zone"]
        DB["Database - TDE"]
        Audit["Audit Logs"]
    end

    Public --> App
    App -->|Token Only| CDE
    CDE --> HSM
    App --> Data

    style CDE fill:#fee2e2,stroke:#dc2626
    style HSM fill:#fecaca,stroke:#dc2626
                </div>
                <div class="mt-4 grid md:grid-cols-2 gap-4">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h4 class="font-bold text-red-700">üî¥ CDE Zone (Level 1)</h4>
                        <p class="text-sm">Cardholder data environment with HSM, encrypted vault, and tokenization. Most restricted access.</p>
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 class="font-bold text-yellow-700">üü° Application Zone (Level 2)</h4>
                        <p class="text-sm">Application servers handle tokens only, never raw card data. mTLS between services.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 2: Technical Stack -->
    <section id="tech-stack" class="section bg-gray-50">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-4xl font-bold mb-2">‚öôÔ∏è 2. Technical Stack Recommendations</h2>
            <p class="text-gray-600 mb-8">Recommended technologies for building a scalable payment gateway</p>

            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Technology Stack Overview</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-indigo-50">
                            <tr>
                                <th class="p-3 rounded-tl-lg">Layer</th>
                                <th class="p-3">Technology</th>
                                <th class="p-3 rounded-tr-lg">Rationale</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr><td class="p-3 font-medium">API Gateway</td><td class="p-3">Kong / AWS API Gateway</td><td class="p-3 text-gray-600">Rate limiting, auth, transformation</td></tr>
                            <tr class="bg-gray-50"><td class="p-3 font-medium">Backend</td><td class="p-3">Go (primary) + Python (ML)</td><td class="p-3 text-gray-600">Performance, concurrency, ML ecosystem</td></tr>
                            <tr><td class="p-3 font-medium">Framework</td><td class="p-3">Go: gin/echo, Python: FastAPI</td><td class="p-3 text-gray-600">Production-proven, async support</td></tr>
                            <tr class="bg-gray-50"><td class="p-3 font-medium">Primary Database</td><td class="p-3">PostgreSQL 15+</td><td class="p-3 text-gray-600">ACID, JSON support, partitioning</td></tr>
                            <tr><td class="p-3 font-medium">Cache</td><td class="p-3">Redis Cluster</td><td class="p-3 text-gray-600">Session, rate limiting, idempotency</td></tr>
                            <tr class="bg-gray-50"><td class="p-3 font-medium">Message Queue</td><td class="p-3">Apache Kafka</td><td class="p-3 text-gray-600">Event sourcing, high throughput</td></tr>
                            <tr><td class="p-3 font-medium">Search</td><td class="p-3">Elasticsearch</td><td class="p-3 text-gray-600">Transaction search, analytics</td></tr>
                            <tr class="bg-gray-50"><td class="p-3 font-medium">Data Warehouse</td><td class="p-3">Snowflake / BigQuery</td><td class="p-3 text-gray-600">Analytics, reporting</td></tr>
                            <tr><td class="p-3 font-medium">Container Orchestration</td><td class="p-3">Kubernetes (EKS/GKE)</td><td class="p-3 text-gray-600">Auto-scaling, deployment</td></tr>
                            <tr class="bg-gray-50"><td class="p-3 font-medium">HSM</td><td class="p-3">AWS CloudHSM / Thales</td><td class="p-3 text-gray-600">PCI DSS key management</td></tr>
                            <tr><td class="p-3 font-medium">Secrets</td><td class="p-3">HashiCorp Vault</td><td class="p-3 text-gray-600">Encryption keys, credentials</td></tr>
                            <tr class="bg-gray-50"><td class="p-3 font-medium">Monitoring</td><td class="p-3">Datadog / Prometheus</td><td class="p-3 text-gray-600">APM, metrics, alerting</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- API Design -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">REST API Design</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-2">Payment Intent Endpoints</h4>
                        <div class="bg-gray-900 rounded-lg p-4 text-sm font-mono text-gray-100">
                            <div class="text-green-400">POST</div> /v1/payment_intents<br>
                            <div class="text-blue-400">GET</div> /v1/payment_intents/{id}<br>
                            <div class="text-yellow-400">POST</div> /v1/payment_intents/{id}/confirm<br>
                            <div class="text-yellow-400">POST</div> /v1/payment_intents/{id}/capture<br>
                            <div class="text-red-400">POST</div> /v1/payment_intents/{id}/cancel
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Other Endpoints</h4>
                        <div class="bg-gray-900 rounded-lg p-4 text-sm font-mono text-gray-100">
                            <div class="text-green-400">POST</div> /v1/payment_methods<br>
                            <div class="text-green-400">POST</div> /v1/refunds<br>
                            <div class="text-green-400">POST</div> /v1/customers<br>
                            <div class="text-blue-400">GET</div> /v1/charges<br>
                            <div class="text-green-400">POST</div> /v1/webhook_endpoints
                        </div>
                    </div>
                </div>

                <h4 class="font-semibold mt-6 mb-2">Create Payment Intent - Request/Response</h4>
                <pre><code class="language-javascript">// Request
POST /v1/payment_intents
{
  "amount": 2000,           // $20.00 in cents
  "currency": "usd",
  "payment_method_types": ["card"],
  "capture_method": "automatic",
  "metadata": {
    "order_id": "order_12345"
  }
}

// Response
{
  "id": "pi_3MtwBwLkdIwHu7ix28a3tqPa",
  "object": "payment_intent",
  "amount": 2000,
  "currency": "usd",
  "status": "requires_payment_method",
  "client_secret": "pi_3MtwBw...secret_YrKJUKribcBjcG8HV8mM",
  "created": 1680800504,
  "livemode": true
}</code></pre>
            </div>
        </div>
    </section>

    <!-- Section 3: Compliance & Legal -->
    <section id="compliance" class="section bg-white">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-4xl font-bold mb-2">üîí 3. Compliance & Legal Requirements</h2>
            <p class="text-gray-600 mb-8">PCI DSS compliance, regional regulations, and KYC/AML requirements</p>

            <!-- PCI DSS Checklist -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">PCI DSS 4.0 Compliance Checklist</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="border rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-3 flex items-center">
                            <span class="bg-indigo-100 text-indigo-700 rounded-full w-8 h-8 flex items-center justify-center mr-2">1</span>
                            Network Security Controls
                        </h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Define firewall/router config standards</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Restrict traffic to CDE</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> No direct public access to CDE</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Document all firewall rules</li>
                        </ul>
                    </div>
                    <div class="border rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-3 flex items-center">
                            <span class="bg-indigo-100 text-indigo-700 rounded-full w-8 h-8 flex items-center justify-center mr-2">3</span>
                            Protect Stored Data
                        </h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Minimize data storage</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> No sensitive auth data post-auth</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Mask PAN (first 6 / last 4)</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Encrypt PAN with strong crypto</li>
                        </ul>
                    </div>
                    <div class="border rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-3 flex items-center">
                            <span class="bg-indigo-100 text-indigo-700 rounded-full w-8 h-8 flex items-center justify-center mr-2">8</span>
                            Authentication
                        </h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Unique user IDs</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> MFA for all CDE access</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Strong password policies</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> No shared accounts</li>
                        </ul>
                    </div>
                    <div class="border rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-3 flex items-center">
                            <span class="bg-indigo-100 text-indigo-700 rounded-full w-8 h-8 flex items-center justify-center mr-2">10</span>
                            Logging & Monitoring
                        </h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Implement audit trails</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Sync all system clocks</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Secure logs from tampering</li>
                            <li class="flex items-center"><input type="checkbox" class="mr-2"> Retain logs for 1 year</li>
                        </ul>
                    </div>
                </div>

                <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h4 class="font-bold text-yellow-800 mb-2">‚ö†Ô∏è Certification Process</h4>
                    <div class="grid md:grid-cols-5 gap-2 text-sm">
                        <div class="text-center p-2 bg-white rounded">
                            <div class="font-bold">1. Scope</div>
                            <div class="text-gray-600">2-4 weeks</div>
                        </div>
                        <div class="text-center p-2 bg-white rounded">
                            <div class="font-bold">2. Gap Analysis</div>
                            <div class="text-gray-600">4-6 weeks</div>
                        </div>
                        <div class="text-center p-2 bg-white rounded">
                            <div class="font-bold">3. Remediation</div>
                            <div class="text-gray-600">8-16 weeks</div>
                        </div>
                        <div class="text-center p-2 bg-white rounded">
                            <div class="font-bold">4. Assessment</div>
                            <div class="text-gray-600">4-8 weeks</div>
                        </div>
                        <div class="text-center p-2 bg-white rounded">
                            <div class="font-bold">5. AOC</div>
                            <div class="text-gray-600">Certification</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Regional Regulations -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Regional Regulations Matrix</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3">Region</th>
                                <th class="p-3">Regulation</th>
                                <th class="p-3">Key Requirements</th>
                                <th class="p-3">Status</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr>
                                <td class="p-3 font-medium">üá™üá∫ Europe</td>
                                <td class="p-3">PSD2/SCA</td>
                                <td class="p-3">Strong Customer Auth (3DS2), Open Banking APIs</td>
                                <td class="p-3"><span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">Active</span></td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="p-3 font-medium">üá™üá∫ Europe</td>
                                <td class="p-3">GDPR</td>
                                <td class="p-3">Data protection, consent, right to erasure</td>
                                <td class="p-3"><span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">Active</span></td>
                            </tr>
                            <tr>
                                <td class="p-3 font-medium">üáÆüá≥ India</td>
                                <td class="p-3">RBI PA/PG Guidelines</td>
                                <td class="p-3">Registration, net worth ‚Çπ25Cr, data localization</td>
                                <td class="p-3"><span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">Active</span></td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="p-3 font-medium">üá∫üá∏ USA</td>
                                <td class="p-3">State MTL</td>
                                <td class="p-3">Per-state licensing (47 states + DC)</td>
                                <td class="p-3"><span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs">Required</span></td>
                            </tr>
                            <tr>
                                <td class="p-3 font-medium">üá∫üá∏ USA</td>
                                <td class="p-3">CCPA/CPRA</td>
                                <td class="p-3">Consumer privacy rights (California)</td>
                                <td class="p-3"><span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">Active</span></td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="p-3 font-medium">üá¨üáß UK</td>
                                <td class="p-3">FCA Authorization</td>
                                <td class="p-3">E-money or payment institution license</td>
                                <td class="p-3"><span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs">Required</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- KYC/AML -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">KYC/AML Requirements</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">Individual Merchants</h4>
                        <div class="space-y-2">
                            <div class="flex items-center p-2 bg-gray-50 rounded">
                                <span class="text-green-500 mr-2">‚úì</span> Government ID (Passport, Driver's License)
                            </div>
                            <div class="flex items-center p-2 bg-gray-50 rounded">
                                <span class="text-green-500 mr-2">‚úì</span> Proof of Address (< 3 months)
                            </div>
                            <div class="flex items-center p-2 bg-gray-50 rounded">
                                <span class="text-green-500 mr-2">‚úì</span> Selfie with ID (Liveness check)
                            </div>
                            <div class="flex items-center p-2 bg-gray-50 rounded">
                                <span class="text-green-500 mr-2">‚úì</span> Source of Funds (Enhanced)
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-3">Business Merchants</h4>
                        <div class="space-y-2">
                            <div class="flex items-center p-2 bg-gray-50 rounded">
                                <span class="text-green-500 mr-2">‚úì</span> Certificate of Incorporation
                            </div>
                            <div class="flex items-center p-2 bg-gray-50 rounded">
                                <span class="text-green-500 mr-2">‚úì</span> Articles of Association
                            </div>
                            <div class="flex items-center p-2 bg-gray-50 rounded">
                                <span class="text-green-500 mr-2">‚úì</span> UBO Declaration (> 25% ownership)
                            </div>
                            <div class="flex items-center p-2 bg-gray-50 rounded">
                                <span class="text-green-500 mr-2">‚úì</span> Director IDs & Proof of Address
                            </div>
                            <div class="flex items-center p-2 bg-gray-50 rounded">
                                <span class="text-green-500 mr-2">‚úì</span> Financial Statements (2 years)
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6 grid md:grid-cols-2 gap-4">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h4 class="font-bold text-red-700 mb-2">üö´ Prohibited Industries</h4>
                        <p class="text-sm text-red-600">Illegal drugs, counterfeit goods, human trafficking, terrorism financing, pyramid schemes</p>
                    </div>
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                        <h4 class="font-bold text-orange-700 mb-2">‚ö†Ô∏è High-Risk Industries</h4>
                        <p class="text-sm text-orange-600">Gambling, adult content, cryptocurrency, forex, weapons, pharmaceuticals</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 4: Core Features -->
    <section id="features" class="section bg-gray-50">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-4xl font-bold mb-2">üí≥ 4. Core Features to Implement</h2>
            <p class="text-gray-600 mb-8">Payment processing flow, fraud detection, webhooks, and more</p>

            <!-- Payment Flow Diagram -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Payment Processing Flow</h3>
                <div class="mermaid">
sequenceDiagram
    participant M as Merchant
    participant API as Payment API
    participant F as Fraud Engine
    participant P as Processor
    participant N as Card Network
    participant B as Bank

    M->>API: Create PaymentIntent
    API-->>M: client_secret
    M->>API: Confirm with card
    API->>F: Analyze risk
    F-->>API: Risk score
    alt High Risk
        API-->>M: requires_action (3DS)
    end
    API->>P: Authorization
    P->>N: Auth request
    N->>B: Verify funds
    B-->>N: Approved
    N-->>P: Auth code
    P-->>API: Success
    API-->>M: succeeded
                </div>
            </div>

            <!-- Payment States -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Payment Intent State Machine</h3>
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-3 py-1 bg-gray-200 rounded-full text-sm">requires_payment_method</span>
                    <span class="text-gray-400">‚Üí</span>
                    <span class="px-3 py-1 bg-yellow-200 rounded-full text-sm">requires_confirmation</span>
                    <span class="text-gray-400">‚Üí</span>
                    <span class="px-3 py-1 bg-orange-200 rounded-full text-sm">requires_action</span>
                    <span class="text-gray-400">‚Üí</span>
                    <span class="px-3 py-1 bg-blue-200 rounded-full text-sm">processing</span>
                    <span class="text-gray-400">‚Üí</span>
                    <span class="px-3 py-1 bg-green-200 rounded-full text-sm">succeeded</span>
                </div>
                <div class="grid md:grid-cols-3 gap-4 text-sm">
                    <div class="p-3 bg-gray-50 rounded">
                        <span class="font-bold">requires_payment_method</span>
                        <p class="text-gray-600">Initial state, waiting for card details</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded">
                        <span class="font-bold">requires_action</span>
                        <p class="text-gray-600">3D Secure authentication needed</p>
                    </div>
                    <div class="p-3 bg-gray-50 rounded">
                        <span class="font-bold">requires_capture</span>
                        <p class="text-gray-600">Auth successful, manual capture needed</p>
                    </div>
                </div>
            </div>

            <!-- Fraud Detection -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Fraud Detection Engine</h3>
                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="text-center p-4 bg-indigo-50 rounded-lg">
                        <div class="text-3xl mb-2">üìã</div>
                        <h4 class="font-bold">Rule Engine</h4>
                        <p class="text-sm text-gray-600">Velocity, blacklists, BIN checks</p>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-3xl mb-2">ü§ñ</div>
                        <h4 class="font-bold">ML Model</h4>
                        <p class="text-sm text-gray-600">Fraud probability scoring</p>
                    </div>
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-3xl mb-2">üì±</div>
                        <h4 class="font-bold">Device Fingerprint</h4>
                        <p class="text-sm text-gray-600">Emulator, VPN detection</p>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-3xl mb-2">üìä</div>
                        <h4 class="font-bold">Behavioral</h4>
                        <p class="text-sm text-gray-600">Pattern analysis</p>
                    </div>
                </div>

                <h4 class="font-semibold mb-2">Fraud Signals & Scoring</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-2 text-left">Signal</th>
                                <th class="p-2 text-left">Score Impact</th>
                                <th class="p-2 text-left">Weight</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr><td class="p-2">Country mismatch (card vs IP)</td><td class="p-2">+40</td><td class="p-2">1.0x</td></tr>
                            <tr><td class="p-2">High-risk BIN</td><td class="p-2">+60</td><td class="p-2">1.2x</td></tr>
                            <tr><td class="p-2">CVV mismatch</td><td class="p-2">+70</td><td class="p-2">1.3x</td></tr>
                            <tr><td class="p-2">Velocity exceeded (24h)</td><td class="p-2">+75</td><td class="p-2">1.2x</td></tr>
                            <tr><td class="p-2">Blacklisted device</td><td class="p-2">+95</td><td class="p-2">2.0x</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 flex gap-4">
                    <div class="flex-1 p-3 bg-green-50 rounded text-center">
                        <div class="font-bold text-green-700">Score &lt; 30</div>
                        <div class="text-sm">Auto-approve</div>
                    </div>
                    <div class="flex-1 p-3 bg-yellow-50 rounded text-center">
                        <div class="font-bold text-yellow-700">30-60</div>
                        <div class="text-sm">Review</div>
                    </div>
                    <div class="flex-1 p-3 bg-orange-50 rounded text-center">
                        <div class="font-bold text-orange-700">60-80</div>
                        <div class="text-sm">3DS Challenge</div>
                    </div>
                    <div class="flex-1 p-3 bg-red-50 rounded text-center">
                        <div class="font-bold text-red-700">Score ‚â• 80</div>
                        <div class="text-sm">Reject</div>
                    </div>
                </div>
            </div>

            <!-- Webhook System -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Webhook System</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-2">Key Events</h4>
                        <div class="space-y-1 text-sm font-mono bg-gray-900 text-gray-100 p-4 rounded-lg">
                            <div><span class="text-green-400">payment_intent.succeeded</span></div>
                            <div><span class="text-yellow-400">payment_intent.payment_failed</span></div>
                            <div><span class="text-blue-400">charge.refunded</span></div>
                            <div><span class="text-red-400">charge.dispute.created</span></div>
                            <div><span class="text-purple-400">payout.paid</span></div>
                            <div><span class="text-cyan-400">customer.subscription.created</span></div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Webhook Payload</h4>
                        <pre><code class="language-javascript">{
  "id": "evt_1234567890",
  "type": "payment_intent.succeeded",
  "created": 1680800504,
  "data": {
    "object": {
      "id": "pi_xxx",
      "amount": 2000,
      "status": "succeeded"
    }
  }
}</code></pre>
                    </div>
                </div>
                <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-bold text-blue-700 mb-2">üîÑ Retry Schedule</h4>
                    <p class="text-sm">5 min ‚Üí 1 hour ‚Üí 6 hours ‚Üí 24 hours ‚Üí 48 hours ‚Üí 72 hours (then fail)</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 5: Go-to-Market -->
    <section id="gtm" class="section bg-white">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-4xl font-bold mb-2">üöÄ 5. Go-to-Market Strategy</h2>
            <p class="text-gray-600 mb-8">Pricing, merchant onboarding, SDKs, and support</p>

            <!-- Pricing Tiers -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Pricing Tiers</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="border-2 border-gray-200 rounded-xl p-6">
                        <h4 class="text-xl font-bold mb-2">Standard</h4>
                        <p class="text-gray-600 text-sm mb-4">Self-service, up to $500K/month</p>
                        <div class="text-3xl font-bold mb-4">2.9% <span class="text-lg font-normal">+ $0.30</span></div>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> No monthly fees</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> No setup fees</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Standard payouts (T+2)</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Email support</li>
                            <li class="flex items-center text-gray-400"><span class="mr-2">‚úó</span> Dedicated support</li>
                        </ul>
                    </div>
                    <div class="border-2 border-indigo-500 rounded-xl p-6 relative">
                        <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-indigo-500 text-white px-3 py-1 rounded-full text-xs">POPULAR</div>
                        <h4 class="text-xl font-bold mb-2">Professional</h4>
                        <p class="text-gray-600 text-sm mb-4">$500K+ monthly volume</p>
                        <div class="text-3xl font-bold mb-4">2.5% <span class="text-lg font-normal">+ $0.25</span></div>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> $99/month</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Dedicated support</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Advanced fraud rules</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Priority webhooks</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Phone support</li>
                        </ul>
                    </div>
                    <div class="border-2 border-gray-200 rounded-xl p-6 bg-gradient-to-br from-gray-50 to-indigo-50">
                        <h4 class="text-xl font-bold mb-2">Enterprise</h4>
                        <p class="text-gray-600 text-sm mb-4">Custom pricing</p>
                        <div class="text-3xl font-bold mb-4">IC++ <span class="text-lg font-normal">pricing</span></div>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Interchange++ pricing</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Volume discounts</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Custom settlements</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> 24/7 phone support</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> 99.99% SLA</li>
                        </ul>
                    </div>
                </div>

                <div class="mt-6 bg-gray-50 rounded-lg p-4">
                    <h4 class="font-semibold mb-2">Additional Fees</h4>
                    <div class="grid md:grid-cols-4 gap-4 text-sm">
                        <div><span class="font-medium">International:</span> +1.0%</div>
                        <div><span class="font-medium">Chargebacks:</span> $15.00</div>
                        <div><span class="font-medium">Instant Payout:</span> 1.5%</div>
                        <div><span class="font-medium">ACH:</span> 0.8% (max $5)</div>
                    </div>
                </div>
            </div>

            <!-- SDK Requirements -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">SDK Requirements</h3>
                <div class="grid md:grid-cols-4 gap-4">
                    <div class="p-4 bg-yellow-50 rounded-lg text-center">
                        <div class="text-2xl mb-2">üåê</div>
                        <h4 class="font-bold">JavaScript</h4>
                        <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded">P0 - Critical</span>
                        <p class="text-xs text-gray-600 mt-2">Tokenization, 3DS, Payment Element</p>
                    </div>
                    <div class="p-4 bg-green-50 rounded-lg text-center">
                        <div class="text-2xl mb-2">üêç</div>
                        <h4 class="font-bold">Python</h4>
                        <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded">P0 - Critical</span>
                        <p class="text-xs text-gray-600 mt-2">Full API, Django/Flask helpers</p>
                    </div>
                    <div class="p-4 bg-green-50 rounded-lg text-center">
                        <div class="text-2xl mb-2">üì¶</div>
                        <h4 class="font-bold">Node.js</h4>
                        <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded">P0 - Critical</span>
                        <p class="text-xs text-gray-600 mt-2">Full API, Webhooks</p>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-lg text-center">
                        <div class="text-2xl mb-2">üì±</div>
                        <h4 class="font-bold">iOS/Android</h4>
                        <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded">P0 - Critical</span>
                        <p class="text-xs text-gray-600 mt-2">Apple Pay, Google Pay, 3DS</p>
                    </div>
                </div>
                <div class="grid md:grid-cols-4 gap-4 mt-4">
                    <div class="p-4 bg-purple-50 rounded-lg text-center">
                        <div class="text-2xl mb-2">üêò</div>
                        <h4 class="font-bold">PHP</h4>
                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">P1</span>
                    </div>
                    <div class="p-4 bg-red-50 rounded-lg text-center">
                        <div class="text-2xl mb-2">üíé</div>
                        <h4 class="font-bold">Ruby</h4>
                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">P1</span>
                    </div>
                    <div class="p-4 bg-orange-50 rounded-lg text-center">
                        <div class="text-2xl mb-2">‚òï</div>
                        <h4 class="font-bold">Java</h4>
                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">P1</span>
                    </div>
                    <div class="p-4 bg-cyan-50 rounded-lg text-center">
                        <div class="text-2xl mb-2">üêπ</div>
                        <h4 class="font-bold">Go</h4>
                        <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">P1</span>
                    </div>
                </div>
            </div>

            <!-- SLA -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Support & SLA Commitments</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3 text-left">Priority</th>
                                <th class="p-3 text-left">Standard</th>
                                <th class="p-3 text-left">Professional</th>
                                <th class="p-3 text-left">Enterprise</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr>
                                <td class="p-3 font-medium">üî¥ Critical</td>
                                <td class="p-3">4 hours</td>
                                <td class="p-3">1 hour</td>
                                <td class="p-3 font-bold text-green-600">15 minutes</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="p-3 font-medium">üü† High</td>
                                <td class="p-3">8 hours</td>
                                <td class="p-3">2 hours</td>
                                <td class="p-3 font-bold text-green-600">30 minutes</td>
                            </tr>
                            <tr>
                                <td class="p-3 font-medium">üü° Medium</td>
                                <td class="p-3">24 hours</td>
                                <td class="p-3">8 hours</td>
                                <td class="p-3">2 hours</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="p-3 font-medium">üü¢ Low</td>
                                <td class="p-3">48 hours</td>
                                <td class="p-3">24 hours</td>
                                <td class="p-3">8 hours</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 grid md:grid-cols-3 gap-4">
                    <div class="p-4 bg-gray-50 rounded-lg text-center">
                        <div class="text-2xl font-bold text-indigo-600">99.9%</div>
                        <div class="text-sm text-gray-600">Standard Uptime</div>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg text-center">
                        <div class="text-2xl font-bold text-indigo-600">99.95%</div>
                        <div class="text-sm text-gray-600">Professional Uptime</div>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg text-center">
                        <div class="text-2xl font-bold text-indigo-600">99.99%</div>
                        <div class="text-sm text-gray-600">Enterprise Uptime</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 6: Timeline & Milestones -->
    <section id="timeline" class="section bg-gray-50">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-4xl font-bold mb-2">üìÖ 6. Timeline & Milestones</h2>
            <p class="text-gray-600 mb-8">Development phases and key milestones for building a production payment gateway</p>

            <!-- Timeline Overview -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Development Timeline (18 Months)</h3>
                <div class="mermaid">
gantt
    title Payment Gateway Development Timeline
    dateFormat  YYYY-MM
    section Foundation
    Infrastructure Setup     :2024-01, 2m
    Core Architecture       :2024-02, 2m
    section Core Services
    Identity & Auth         :2024-03, 2m
    Merchant Service        :2024-04, 2m
    Payment Orchestrator    :2024-05, 3m
    section Security
    Tokenization Service    :2024-06, 2m
    PCI DSS Prep           :2024-07, 3m
    section Integration
    Processor Integration   :2024-08, 2m
    Testing & QA           :2024-09, 2m
    section Launch
    MVP Launch             :milestone, 2024-10, 0d
    section Scale
    Fraud Engine           :2024-10, 3m
    Settlement Engine      :2024-11, 2m
    Full Production        :milestone, 2025-06, 0d
                </div>
            </div>

            <!-- Development Phases -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Development Phases</h3>
                <div class="space-y-4">
                    <div class="border-l-4 border-indigo-500 pl-4 py-2">
                        <div class="flex items-center justify-between">
                            <h4 class="font-bold text-lg">Phase 1: Foundation (Months 1-3)</h4>
                            <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-sm">$180K</span>
                        </div>
                        <ul class="mt-2 text-sm text-gray-600 grid md:grid-cols-2 gap-1">
                            <li>‚Ä¢ Infrastructure setup (K8s, CI/CD)</li>
                            <li>‚Ä¢ Core database schema design</li>
                            <li>‚Ä¢ API Gateway configuration</li>
                            <li>‚Ä¢ Identity & authentication service</li>
                        </ul>
                    </div>
                    <div class="border-l-4 border-purple-500 pl-4 py-2">
                        <div class="flex items-center justify-between">
                            <h4 class="font-bold text-lg">Phase 2: Core Payment (Months 4-6)</h4>
                            <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm">$300K</span>
                        </div>
                        <ul class="mt-2 text-sm text-gray-600 grid md:grid-cols-2 gap-1">
                            <li>‚Ä¢ Payment orchestrator service</li>
                            <li>‚Ä¢ Tokenization & card vault</li>
                            <li>‚Ä¢ First processor integration</li>
                            <li>‚Ä¢ Basic merchant dashboard</li>
                        </ul>
                    </div>
                    <div class="border-l-4 border-blue-500 pl-4 py-2">
                        <div class="flex items-center justify-between">
                            <h4 class="font-bold text-lg">Phase 3: Security & Compliance (Months 7-9)</h4>
                            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm">$350K</span>
                        </div>
                        <ul class="mt-2 text-sm text-gray-600 grid md:grid-cols-2 gap-1">
                            <li>‚Ä¢ PCI DSS Level 1 certification</li>
                            <li>‚Ä¢ HSM integration</li>
                            <li>‚Ä¢ Security audit & penetration testing</li>
                            <li>‚Ä¢ 3D Secure implementation</li>
                        </ul>
                    </div>
                    <div class="border-l-4 border-green-500 pl-4 py-2">
                        <div class="flex items-center justify-between">
                            <h4 class="font-bold text-lg">Phase 4: MVP Launch (Month 10)</h4>
                            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">MVP üöÄ</span>
                        </div>
                        <ul class="mt-2 text-sm text-gray-600 grid md:grid-cols-2 gap-1">
                            <li>‚Ä¢ Limited beta with 5-10 merchants</li>
                            <li>‚Ä¢ Card payments (Visa, Mastercard)</li>
                            <li>‚Ä¢ USD only, single processor</li>
                            <li>‚Ä¢ Basic fraud rules</li>
                        </ul>
                    </div>
                    <div class="border-l-4 border-orange-500 pl-4 py-2">
                        <div class="flex items-center justify-between">
                            <h4 class="font-bold text-lg">Phase 5: Scale (Months 11-18)</h4>
                            <span class="bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-sm">$600K</span>
                        </div>
                        <ul class="mt-2 text-sm text-gray-600 grid md:grid-cols-2 gap-1">
                            <li>‚Ä¢ ML-based fraud detection</li>
                            <li>‚Ä¢ Multi-processor smart routing</li>
                            <li>‚Ä¢ International expansion (50+ currencies)</li>
                            <li>‚Ä¢ Settlement & reconciliation engine</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- MVP vs Full Production -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">MVP vs Full Production Features</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-3 flex items-center">
                            <span class="text-2xl mr-2">üéØ</span> MVP (Month 10)
                        </h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Card payments (Visa, MC)</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Single processor</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> USD only</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Basic fraud rules</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Manual settlement</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Email support</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> JS + Python SDK</li>
                        </ul>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-3 flex items-center">
                            <span class="text-2xl mr-2">üèÜ</span> Full Production (Month 18)
                        </h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> All card networks + ACH</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Multi-processor failover</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> 50+ currencies</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> ML fraud detection</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> Automated settlement</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> 24/7 support</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">‚úì</span> 8+ SDKs</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 7: Costs -->
    <section id="costs" class="section bg-white">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-4xl font-bold mb-2">üí∞ 7. Cost Estimates</h2>
            <p class="text-gray-600 mb-8">Comprehensive breakdown of development, infrastructure, and operational costs</p>

            <!-- Team Structure -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Development Team Structure</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-indigo-50">
                            <tr>
                                <th class="p-3 text-left">Role</th>
                                <th class="p-3 text-center">Count</th>
                                <th class="p-3 text-right">Annual Cost</th>
                                <th class="p-3 text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr><td class="p-3">Engineering Manager</td><td class="p-3 text-center">1</td><td class="p-3 text-right">$200K</td><td class="p-3 text-right font-medium">$200K</td></tr>
                            <tr class="bg-gray-50"><td class="p-3">Staff Engineer</td><td class="p-3 text-center">2</td><td class="p-3 text-right">$250K</td><td class="p-3 text-right font-medium">$500K</td></tr>
                            <tr><td class="p-3">Senior Backend Engineer</td><td class="p-3 text-center">4</td><td class="p-3 text-right">$180K</td><td class="p-3 text-right font-medium">$720K</td></tr>
                            <tr class="bg-gray-50"><td class="p-3">Backend Engineer</td><td class="p-3 text-center">4</td><td class="p-3 text-right">$140K</td><td class="p-3 text-right font-medium">$560K</td></tr>
                            <tr><td class="p-3">Frontend Engineer</td><td class="p-3 text-center">2</td><td class="p-3 text-right">$150K</td><td class="p-3 text-right font-medium">$300K</td></tr>
                            <tr class="bg-gray-50"><td class="p-3">ML Engineer</td><td class="p-3 text-center">2</td><td class="p-3 text-right">$200K</td><td class="p-3 text-right font-medium">$400K</td></tr>
                            <tr><td class="p-3">Security Engineer</td><td class="p-3 text-center">2</td><td class="p-3 text-right">$180K</td><td class="p-3 text-right font-medium">$360K</td></tr>
                            <tr class="bg-gray-50"><td class="p-3">DevOps/SRE</td><td class="p-3 text-center">2</td><td class="p-3 text-right">$170K</td><td class="p-3 text-right font-medium">$340K</td></tr>
                            <tr><td class="p-3">QA Engineer</td><td class="p-3 text-center">2</td><td class="p-3 text-right">$120K</td><td class="p-3 text-right font-medium">$240K</td></tr>
                            <tr class="bg-gray-50"><td class="p-3">Product Manager</td><td class="p-3 text-center">2</td><td class="p-3 text-right">$180K</td><td class="p-3 text-right font-medium">$360K</td></tr>
                        </tbody>
                        <tfoot class="bg-indigo-100">
                            <tr><td class="p-3 font-bold">TOTAL TEAM</td><td class="p-3 text-center font-bold">23</td><td class="p-3"></td><td class="p-3 text-right font-bold text-indigo-700">$3.98M/year</td></tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- Infrastructure Costs -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Infrastructure Costs (Monthly)</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="cost-card">
                        <h4 class="font-bold text-lg mb-3 flex items-center justify-between">
                            MVP
                            <span class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded text-xs">Month 10</span>
                        </h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex justify-between"><span>Compute (K8s)</span><span>$8K</span></li>
                            <li class="flex justify-between"><span>Database (RDS)</span><span>$3K</span></li>
                            <li class="flex justify-between"><span>Redis Cluster</span><span>$1.5K</span></li>
                            <li class="flex justify-between"><span>CloudHSM</span><span>$5K</span></li>
                            <li class="flex justify-between"><span>Monitoring</span><span>$2K</span></li>
                            <li class="flex justify-between"><span>Other</span><span>$2.5K</span></li>
                            <li class="flex justify-between border-t pt-2 font-bold"><span>Total</span><span class="text-indigo-600">$22K/mo</span></li>
                        </ul>
                    </div>
                    <div class="cost-card border-2 border-indigo-300">
                        <h4 class="font-bold text-lg mb-3 flex items-center justify-between">
                            Production
                            <span class="bg-green-200 text-green-800 px-2 py-1 rounded text-xs">Month 18</span>
                        </h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex justify-between"><span>Compute (Multi-AZ)</span><span>$25K</span></li>
                            <li class="flex justify-between"><span>Database (HA)</span><span>$12K</span></li>
                            <li class="flex justify-between"><span>Redis Cluster</span><span>$5K</span></li>
                            <li class="flex justify-between"><span>CloudHSM (HA)</span><span>$10K</span></li>
                            <li class="flex justify-between"><span>Kafka</span><span>$8K</span></li>
                            <li class="flex justify-between"><span>Monitoring + Security</span><span>$10K</span></li>
                            <li class="flex justify-between border-t pt-2 font-bold"><span>Total</span><span class="text-indigo-600">$70K/mo</span></li>
                        </ul>
                    </div>
                    <div class="cost-card bg-gradient-to-br from-purple-50 to-indigo-50">
                        <h4 class="font-bold text-lg mb-3 flex items-center justify-between">
                            Scale
                            <span class="bg-purple-200 text-purple-800 px-2 py-1 rounded text-xs">Year 2+</span>
                        </h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex justify-between"><span>Compute (Multi-Region)</span><span>$80K</span></li>
                            <li class="flex justify-between"><span>Database (Global)</span><span>$40K</span></li>
                            <li class="flex justify-between"><span>Data Warehouse</span><span>$15K</span></li>
                            <li class="flex justify-between"><span>ML Infrastructure</span><span>$20K</span></li>
                            <li class="flex justify-between"><span>Security & Compliance</span><span>$25K</span></li>
                            <li class="flex justify-between"><span>Reserved Capacity</span><span>-30%</span></li>
                            <li class="flex justify-between border-t pt-2 font-bold"><span>Total</span><span class="text-indigo-600">$150K/mo</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Compliance & Third-Party Costs -->
            <div class="card">
                <h3 class="text-2xl font-semibold mb-4">Compliance & Third-Party Costs</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold mb-3">One-Time Costs</h4>
                        <ul class="space-y-2">
                            <li class="flex justify-between p-2 bg-gray-50 rounded"><span>PCI DSS Level 1 (QSA)</span><span class="font-medium">$150K-250K</span></li>
                            <li class="flex justify-between p-2 rounded"><span>SOC 2 Type II</span><span class="font-medium">$50K-100K</span></li>
                            <li class="flex justify-between p-2 bg-gray-50 rounded"><span>State MTL (all states)</span><span class="font-medium">$500K-1M</span></li>
                            <li class="flex justify-between p-2 rounded"><span>Legal & Contracts</span><span class="font-medium">$100K-200K</span></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-3">Annual Recurring</h4>
                        <ul class="space-y-2">
                            <li class="flex justify-between p-2 bg-gray-50 rounded"><span>PCI DSS Re-certification</span><span class="font-medium">$75K-150K</span></li>
                            <li class="flex justify-between p-2 rounded"><span>Pen Testing (quarterly)</span><span class="font-medium">$80K-120K</span></li>
                            <li class="flex justify-between p-2 bg-gray-50 rounded"><span>Insurance (cyber + E&O)</span><span class="font-medium">$100K-200K</span></li>
                            <li class="flex justify-between p-2 rounded"><span>License Renewals</span><span class="font-medium">$100K-150K</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Total Cost Summary -->
            <div class="card bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                <h3 class="text-2xl font-semibold mb-4">üíµ Total Investment Summary</h3>
                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white/10 rounded-lg p-4 text-center">
                        <div class="text-sm opacity-75">Year 1 Development</div>
                        <div class="text-3xl font-bold">$4.5M</div>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4 text-center">
                        <div class="text-sm opacity-75">Infrastructure (Y1)</div>
                        <div class="text-3xl font-bold">$500K</div>
                    </div>
                    <div class="bg-white/10 rounded-lg p-4 text-center">
                        <div class="text-sm opacity-75">Compliance (Y1)</div>
                        <div class="text-3xl font-bold">$1M</div>
                    </div>
                    <div class="bg-white/20 rounded-lg p-4 text-center border-2 border-white/30">
                        <div class="text-sm opacity-75">Total Year 1</div>
                        <div class="text-3xl font-bold">$6M</div>
                    </div>
                </div>
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="font-semibold mb-2">Break-Even Analysis</h4>
                    <p class="text-sm opacity-90">At 2.9% + $0.30 pricing with average transaction of $100:</p>
                    <div class="mt-2 flex items-center gap-4">
                        <div><span class="font-bold">$2M</span> monthly volume = Break-even on operations</div>
                        <div><span class="font-bold">$10M</span> monthly volume = Full profitability</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid md:grid-cols-3 gap-8 mb-8">
                <div>
                    <h4 class="font-bold text-lg mb-4">Key Takeaways</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li>‚úì Start with compliance from day 1</li>
                        <li>‚úì Tokenization reduces PCI scope</li>
                        <li>‚úì Plan for 18-month timeline minimum</li>
                        <li>‚úì Budget $6M+ for Year 1</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Critical Success Factors</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li>‚úì PCI DSS Level 1 certification</li>
                        <li>‚úì 99.99% uptime SLA</li>
                        <li>‚úì Sub-200ms latency</li>
                        <li>‚úì Comprehensive fraud detection</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-lg mb-4">Recommended Approach</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li>‚úì Start as PayFac partner</li>
                        <li>‚úì Use existing tokenization (VGS)</li>
                        <li>‚úì Focus on single market first</li>
                        <li>‚úì Build orchestration layer</li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 pt-8 text-center text-gray-500 text-sm">
                <p>Payment Gateway System Guide ‚Ä¢ Generated for educational purposes</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            event.target.classList.add('active');
        }

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Active navigation on scroll
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('#nav-links a');
            let current = '';

            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (pageYOffset >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });

        // ============================================
        // PAYMENT FLOW ANIMATION ENGINE
        // ============================================

        const PaymentAnimation = {
            isRunning: false,
            currentStep: 0,
            speed: 1000,
            scenario: 'success',

            nodes: ['customer', 'merchant', 'gateway', 'tokenizer', 'fraud', '3ds', 'processor', 'network', 'bank', 'result'],
            arrows: ['arrow-1', 'arrow-2', 'arrow-3', 'arrow-4', 'arrow-5', 'arrow-6'],

            steps: {
                success: [
                    { node: 'customer', title: 'Customer Initiates Payment', detail: 'Customer enters card details (4242 4242 4242 4242) on the checkout page', data: { card: '4242...4242', amount: '$99.00', currency: 'USD' } },
                    { node: 'merchant', arrow: 'arrow-1', title: 'Merchant Creates PaymentIntent', detail: 'Merchant backend calls POST /v1/payment_intents with amount and currency', data: { endpoint: 'POST /v1/payment_intents', amount: 9900, currency: 'usd' } },
                    { node: 'gateway', arrow: 'arrow-2', title: 'API Gateway Processing', detail: 'Request authenticated, rate limits checked, routed to payment service', data: { api_key: 'sk_live_...', rate_limit: '100/min', status: 'passed' } },
                    { node: 'tokenizer', arrow: 'arrow-3', title: 'Card Tokenization', detail: 'Card PAN encrypted and stored in vault, token generated', data: { token: 'tok_1abc2def3ghi', vault: 'HSM-encrypted', time: '45ms' }, timing: 'token' },
                    { node: 'fraud', arrow: 'arrow-4', title: 'Fraud Analysis', detail: 'ML model analyzes transaction, velocity checks, device fingerprint verified', data: { risk_score: 12, risk_level: 'low', signals: ['trusted_device', 'known_customer'] }, timing: 'fraud' },
                    { node: '3ds', title: '3D Secure Check', detail: 'Low risk score - 3DS challenge not required, proceeding to authorization', data: { '3ds_required': false, reason: 'low_risk_exemption' } },
                    { node: 'processor', arrow: 'arrow-5', title: 'Payment Processor', detail: 'Authorization request sent to acquiring bank via processor', data: { processor: 'stripe_us', merchant_id: 'acct_1234', request_id: 'req_abc123' } },
                    { node: 'network', arrow: 'arrow-6', title: 'Card Network Routing', detail: 'Visa network routes authorization to issuing bank', data: { network: 'visa', bin: '424242', issuer_country: 'US' } },
                    { node: 'bank', title: 'Issuing Bank Authorization', detail: 'Bank verifies funds, checks limits, approves transaction', data: { auth_code: 'A12345', response_code: '00', available_credit: '$5,000' }, timing: 'auth' },
                    { node: 'result', title: '‚úÖ Payment Successful!', detail: 'Payment confirmed, webhook sent to merchant, receipt generated', data: { status: 'succeeded', charge_id: 'ch_1abc2def', receipt_url: 'https://...' }, result: 'success' }
                ],
                '3ds': [
                    { node: 'customer', title: 'Customer Initiates Payment', detail: 'Customer enters card details on the checkout page', data: { card: '4000...0002', amount: '$299.00', currency: 'USD' } },
                    { node: 'merchant', arrow: 'arrow-1', title: 'Merchant Creates PaymentIntent', detail: 'Merchant backend calls POST /v1/payment_intents', data: { endpoint: 'POST /v1/payment_intents', amount: 29900, currency: 'usd' } },
                    { node: 'gateway', arrow: 'arrow-2', title: 'API Gateway Processing', detail: 'Request authenticated and routed', data: { api_key: 'sk_live_...', status: 'passed' } },
                    { node: 'tokenizer', arrow: 'arrow-3', title: 'Card Tokenization', detail: 'Card securely tokenized', data: { token: 'tok_2xyz3abc', time: '42ms' }, timing: 'token' },
                    { node: 'fraud', arrow: 'arrow-4', title: 'Fraud Analysis', detail: 'Medium risk detected - new device, high amount', data: { risk_score: 55, risk_level: 'elevated', signals: ['new_device', 'high_amount'] }, timing: 'fraud' },
                    { node: '3ds', title: 'üîê 3D Secure Required', detail: 'Customer redirected to bank for authentication', data: { '3ds_required': true, version: '2.2', challenge: 'required' } },
                    { node: 'customer', title: 'Customer Authenticates', detail: 'Customer completes 3DS challenge (OTP/biometric)', data: { auth_method: 'otp', status: 'authenticated' } },
                    { node: 'processor', arrow: 'arrow-5', title: 'Payment Processor', detail: 'Authorization with 3DS proof sent', data: { eci: '05', cavv: 'AAABBJg...', processor: 'stripe_us' } },
                    { node: 'bank', title: 'Bank Authorization', detail: 'Bank approves with liability shift to issuer', data: { auth_code: 'B67890', liability_shift: true }, timing: 'auth' },
                    { node: 'result', title: '‚úÖ Payment Successful (3DS)', detail: 'Payment confirmed with strong authentication', data: { status: 'succeeded', authentication: '3ds_authenticated' }, result: 'success' }
                ],
                fraud: [
                    { node: 'customer', title: 'Customer Initiates Payment', detail: 'Suspicious payment attempt detected', data: { card: '4000...0019', amount: '$2,500.00', ip: '185.x.x.x (VPN)' } },
                    { node: 'merchant', arrow: 'arrow-1', title: 'Merchant Creates PaymentIntent', detail: 'Payment request received', data: { amount: 250000, currency: 'usd' } },
                    { node: 'gateway', arrow: 'arrow-2', title: 'API Gateway Processing', detail: 'Request passes initial checks', data: { status: 'passed' } },
                    { node: 'tokenizer', arrow: 'arrow-3', title: 'Card Tokenization', detail: 'Card tokenized for analysis', data: { token: 'tok_3sus4pect', time: '38ms' }, timing: 'token' },
                    { node: 'fraud', arrow: 'arrow-4', title: 'üö® Fraud Detected!', detail: 'Multiple high-risk signals triggered', data: { risk_score: 92, risk_level: 'critical', signals: ['vpn_detected', 'velocity_exceeded', 'card_country_mismatch', 'device_fingerprint_suspicious'] }, timing: 'fraud' },
                    { node: 'result', title: 'üö´ Payment Blocked', detail: 'Transaction rejected by fraud engine before authorization', data: { status: 'blocked', reason: 'fraud_detected', decline_code: 'fraudulent' }, result: 'blocked' }
                ],
                declined: [
                    { node: 'customer', title: 'Customer Initiates Payment', detail: 'Customer enters card details', data: { card: '4000...0002', amount: '$150.00' } },
                    { node: 'merchant', arrow: 'arrow-1', title: 'Merchant Creates PaymentIntent', detail: 'Payment request created', data: { amount: 15000, currency: 'usd' } },
                    { node: 'gateway', arrow: 'arrow-2', title: 'API Gateway Processing', detail: 'Request authenticated', data: { status: 'passed' } },
                    { node: 'tokenizer', arrow: 'arrow-3', title: 'Card Tokenization', detail: 'Card tokenized', data: { token: 'tok_4dec5line', time: '41ms' }, timing: 'token' },
                    { node: 'fraud', arrow: 'arrow-4', title: 'Fraud Analysis', detail: 'Low risk - proceeding', data: { risk_score: 8, risk_level: 'low' }, timing: 'fraud' },
                    { node: 'processor', arrow: 'arrow-5', title: 'Payment Processor', detail: 'Sending authorization request', data: { processor: 'stripe_us' } },
                    { node: 'network', arrow: 'arrow-6', title: 'Card Network Routing', detail: 'Routing to issuing bank', data: { network: 'visa' } },
                    { node: 'bank', title: '‚ùå Bank Declines', detail: 'Insufficient funds in customer account', data: { response_code: '51', decline_reason: 'insufficient_funds' }, timing: 'auth' },
                    { node: 'result', title: '‚ùå Payment Declined', detail: 'Card declined by issuing bank', data: { status: 'failed', decline_code: 'insufficient_funds', message: 'Your card has insufficient funds.' }, result: 'declined' }
                ]
            },

            init() {
                document.getElementById('startAnimation').addEventListener('click', () => this.toggle());
                document.getElementById('resetAnimation').addEventListener('click', () => this.reset());
                document.getElementById('scenarioSelect').addEventListener('change', (e) => {
                    this.scenario = e.target.value;
                    this.reset();
                });
                document.getElementById('speedControl').addEventListener('input', (e) => {
                    const speeds = { 1: 2000, 2: 1500, 3: 1000, 4: 600, 5: 300 };
                    const labels = { 1: 'Slow', 2: 'Slower', 3: 'Normal', 4: 'Fast', 5: 'Very Fast' };
                    this.speed = speeds[e.target.value];
                    document.getElementById('speedLabel').textContent = labels[e.target.value];
                });
            },

            toggle() {
                if (this.isRunning) {
                    this.pause();
                } else {
                    this.start();
                }
            },

            async start() {
                if (this.currentStep >= this.steps[this.scenario].length) {
                    this.reset();
                }
                this.isRunning = true;
                document.getElementById('playIcon').textContent = '‚è∏Ô∏è';
                document.getElementById('startAnimation').querySelector('span:last-child')?.remove();

                const steps = this.steps[this.scenario];
                const startTime = Date.now();

                for (let i = this.currentStep; i < steps.length && this.isRunning; i++) {
                    this.currentStep = i;
                    await this.animateStep(steps[i], i, steps.length);
                    if (this.isRunning) {
                        await this.delay(this.speed);
                    }
                }

                if (this.currentStep >= steps.length - 1) {
                    const totalTime = Date.now() - startTime;
                    document.getElementById('time-total').textContent = `${totalTime}ms`;
                    this.isRunning = false;
                    document.getElementById('playIcon').textContent = 'üîÑ';
                }
            },

            pause() {
                this.isRunning = false;
                document.getElementById('playIcon').textContent = '‚ñ∂Ô∏è';
            },

            reset() {
                this.isRunning = false;
                this.currentStep = 0;
                document.getElementById('playIcon').textContent = '‚ñ∂Ô∏è';
                document.getElementById('progressBar').style.width = '0%';

                // Original node styles mapping
                const nodeStyles = {
                    'customer': 'flow-node bg-blue-500/20 border-2 border-blue-400 rounded-xl p-4 w-36 text-center',
                    'merchant': 'flow-node bg-purple-500/20 border-2 border-purple-400 rounded-xl p-4 w-36 text-center',
                    'gateway': 'flow-node bg-indigo-500/20 border-2 border-indigo-400 rounded-xl p-4 w-36 text-center',
                    'tokenizer': 'flow-node bg-yellow-500/20 border-2 border-yellow-400 rounded-xl p-4 w-36 text-center',
                    'fraud': 'flow-node bg-red-500/20 border-2 border-red-400 rounded-xl p-4 w-36 text-center',
                    '3ds': 'flow-node bg-orange-500/20 border-2 border-orange-400 rounded-xl p-4 w-36 text-center',
                    'processor': 'flow-node bg-cyan-500/20 border-2 border-cyan-400 rounded-xl p-4 w-36 text-center',
                    'network': 'flow-node bg-pink-500/20 border-2 border-pink-400 rounded-xl p-4 w-36 text-center',
                    'bank': 'flow-node bg-emerald-500/20 border-2 border-emerald-400 rounded-xl p-4 w-36 text-center',
                    'result': 'flow-node bg-gray-500/20 border-2 border-gray-400 rounded-xl p-4 w-48 text-center'
                };

                // Reset all nodes to original styles
                this.nodes.forEach(node => {
                    const el = document.getElementById('node-' + node);
                    if (el && nodeStyles[node]) {
                        el.className = nodeStyles[node];
                    }
                });

                // Reset arrows
                this.arrows.forEach(arrow => {
                    const el = document.getElementById(arrow);
                    if (el) {
                        el.className = 'flow-arrow text-2xl text-gray-500';
                        el.textContent = '‚Üí';
                    }
                });

                // Reset result node content
                document.getElementById('resultIcon').textContent = '‚è≥';
                document.getElementById('resultText').textContent = 'Waiting...';
                document.getElementById('resultDetail').textContent = 'Start the animation';

                // Reset panels
                document.getElementById('stepDetails').innerHTML = `
                    <div class="bg-white/10 rounded-lg p-4">
                        <div class="text-sm text-indigo-300 mb-1">Step 0 of ${this.steps[this.scenario].length}</div>
                        <div class="font-semibold text-lg mb-2">Ready to Start</div>
                        <p class="text-sm text-gray-300">Click "Start Payment" to begin the animation.</p>
                    </div>
                `;
                document.getElementById('liveData').innerHTML = '<div class="text-gray-500">// Payment data will appear here...</div>';
                document.getElementById('eventLog').innerHTML = '<div class="text-gray-500">[System] Ready to process payments...</div>';

                // Reset timing
                ['token', 'fraud', 'auth', 'total'].forEach(t => {
                    const el = document.getElementById('time-' + t);
                    if (el) {
                        el.textContent = '--';
                        el.className = 'text-gray-400';
                    }
                });
            },

            async animateStep(step, index, total) {
                // Update progress bar
                const progress = ((index + 1) / total) * 100;
                document.getElementById('progressBar').style.width = progress + '%';

                // Activate current node
                const nodeEl = document.getElementById('node-' + step.node);
                if (nodeEl) {
                    nodeEl.classList.add('active');
                }

                // Animate arrow if present
                if (step.arrow) {
                    const arrowEl = document.getElementById(step.arrow);
                    if (arrowEl) {
                        arrowEl.classList.add('active');
                        arrowEl.textContent = '‚Üí‚Üí‚Üí';
                    }
                }

                // Update step details panel
                document.getElementById('stepDetails').innerHTML = `
                    <div class="step-detail bg-white/10 rounded-lg p-4">
                        <div class="text-sm text-indigo-300 mb-1">Step ${index + 1} of ${total}</div>
                        <div class="font-semibold text-lg mb-2">${step.title}</div>
                        <p class="text-sm text-gray-300">${step.detail}</p>
                    </div>
                `;

                // Update live data
                if (step.data) {
                    const dataHtml = JSON.stringify(step.data, null, 2)
                        .replace(/"([^"]+)":/g, '<span class="text-purple-400">"$1"</span>:')
                        .replace(/: "([^"]+)"/g, ': <span class="text-green-400">"$1"</span>')
                        .replace(/: (\d+)/g, ': <span class="text-yellow-400">$1</span>')
                        .replace(/: (true|false)/g, ': <span class="text-blue-400">$1</span>');
                    document.getElementById('liveData').innerHTML = `<pre>${dataHtml}</pre>`;
                }

                // Add to event log
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = step.result === 'blocked' || step.result === 'declined' ? 'text-red-400' :
                                     step.result === 'success' ? 'text-green-400' : 'text-indigo-300';
                logEntry.textContent = `[${timestamp}] ${step.title}`;
                document.getElementById('eventLog').appendChild(logEntry);
                document.getElementById('eventLog').scrollTop = document.getElementById('eventLog').scrollHeight;

                // Update timing if applicable
                if (step.timing) {
                    const times = { token: '45ms', fraud: '120ms', auth: '350ms' };
                    document.getElementById('time-' + step.timing).textContent = times[step.timing];
                    document.getElementById('time-' + step.timing).className = 'text-green-400';
                }

                // Handle result
                if (step.result) {
                    const resultNode = document.getElementById('node-result');
                    const resultIcon = document.getElementById('resultIcon');
                    const resultText = document.getElementById('resultText');
                    const resultDetail = document.getElementById('resultDetail');

                    if (step.result === 'success') {
                        resultNode.className = 'flow-node bg-green-500/30 border-2 border-green-400 rounded-xl p-4 w-48 text-center';
                        resultIcon.textContent = '‚úÖ';
                        resultText.textContent = 'Payment Successful!';
                        resultDetail.textContent = step.data.charge_id || 'Transaction complete';
                    } else if (step.result === 'blocked') {
                        resultNode.className = 'flow-node bg-red-500/30 border-2 border-red-400 rounded-xl p-4 w-48 text-center';
                        resultIcon.textContent = 'üö´';
                        resultText.textContent = 'Blocked by Fraud';
                        resultDetail.textContent = 'High risk score detected';
                    } else if (step.result === 'declined') {
                        resultNode.className = 'flow-node bg-orange-500/30 border-2 border-orange-400 rounded-xl p-4 w-48 text-center';
                        resultIcon.textContent = '‚ùå';
                        resultText.textContent = 'Card Declined';
                        resultDetail.textContent = step.data.decline_code;
                    }
                }

                // Mark previous nodes as completed
                await this.delay(this.speed * 0.8);
                if (nodeEl && !step.result) {
                    nodeEl.classList.remove('active');
                    nodeEl.classList.add('completed');
                }
                if (step.arrow) {
                    const arrowEl = document.getElementById(step.arrow);
                    if (arrowEl) {
                        arrowEl.classList.remove('active');
                        arrowEl.classList.add('completed');
                        arrowEl.textContent = '‚úì';
                    }
                }
            },

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        };

        // Initialize animation on page load
        document.addEventListener('DOMContentLoaded', () => {
            PaymentAnimation.init();
        });
    </script>
</body>
</html>

